@model CheckoutPageModel

@{
	ViewData["Title"] = "Checkout";
}

<h4>Please review your selections</h4>
<div class="row my-3">
	<table class="table table-hover">
		<thead>
			<tr>				
				<th>Date</th>
				<th>Hour</th>
				<th>Court</th>
				<th>Price</th>
				<th>@*delete button*@</th>
			</tr>
		</thead>
		<tbody>
			@{
				int counter = 0;

				foreach(SlotModel entry in Model.Entries)
				{
					string hourString = $"{entry.DaySlot:d2}:00-{entry.DaySlot+1:d2}:00";
					string priceString = $"{entry.Price:f2} €";

					<tr id="entry-@counter" class="entry" data-price="@entry.Price">
						<td>@entry.Date.ToShortDateString()</td>
						<td>@hourString</td>
						<td>@entry.CourtName</td>
						<td>@priceString</td>
						<td><button type="button" class="btn btn-danger btn-sm" onclick="removeAndUpdatePrice('entry-@counter')">Remove</button></td>
					</tr>

					counter++;
				}
			}			
		</tbody>
	</table>
	<div class="text-end"><b>Total Price:&emsp;</b><span id="totalPriceSpan">@Model.TotalPrice</span>&nbsp;€</div>
	<div class="col-1">
		<a class="btn btn-primary" asp-action="View">&lt; Back</a>
	</div>	
</div>

@section Scripts{
	<script>
		function removeAndUpdatePrice(id){
			document.getElementById(id).remove();

			const entryRows = document.getElementsByClassName('entry');
			var totPrice = 0;

			for(let i = 0; i < entryRows.length; i++){
				totPrice += parseFloat(entryRows[i].dataset.price); 
			}

			document.getElementById('totalPriceSpan').innerText = totPrice.toLocaleString('it-IT', {minimumFractionDigits: 2, maximumFractionDigits: 2});
		}
	</script>
}
